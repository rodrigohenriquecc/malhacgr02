<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>CGR 02 - Sistema de Localização</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0d47a1" />
  <meta name="description" content="Sistema de localização e visualização de rodovias CGR 02" />
  <link rel="icon" href="data:," />

  <!-- pré-conexão às CDNs -->
  <link rel="preconnect" href="https://unpkg.com" />
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />

  <!-- Leaflet + HeatLayer -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js" defer></script>

  <!-- JSZip, shp.js, Turf, PapaParse, toGeoJSON -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/shpjs@3.6.2/dist/shp.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@7.2.0/turf.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/togeojson/0.16.0/togeojson.min.js" defer></script>

  <!-- SheetJS (XLSX) para leitura de planilhas Excel no cliente -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js" defer></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js" defer></script>

  <!-- scripts principais -->
  <script src="assets/js/script_colaborativo.js" defer></script>
  <link rel="stylesheet" href="assets/css/style.css" />

  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    #map { height: 100%; width: 100%; }
  </style>
</head>
<body>
  <!-- Filtro de rodovia (KMZ) - MOBILE FIRST -->
  <div id="rodovia-filter" class="rodovia-filter" role="region" aria-label="Filtro de rodovia">
    <label for="select-rodovia" class="filter-label">Rodovia:</label>
    <select id="select-rodovia" class="filter-select" aria-label="Selecionar rodovia">
      <option value="">Todas</option>
    </select>
    <button id="btn-rod-clear" class="filter-button" aria-label="Limpar filtro">Limpar</button>
  </div>

  <!-- Card de Metadados - MOBILE OPTIMIZED -->

  
  <!-- Painel da Planilha XLSX - MOBILE OPTIMIZED -->
  <div id="malha-xlsx-panel" class="info-card data-panel" role="region" aria-label="Dados da planilha MALHA">
    <div class="card-header">
      <strong class="card-title">Malha (MALHA CGR02SAC.xlsx)</strong>
      <button id="btn-toggle-malha-panel" class="card-toggle" aria-label="Retrair painel" title="Retrair/Expandir painel">
        <span id="icon-toggle-malha">&#9660;</span>
      </button>
    </div>
    <div id="malha-xlsx-table-container" class="table-container">
      <div class="loading-text">Carregando planilha...</div>
    </div>
  </div>
  
  <!-- Mapa principal -->
  <div id="map" role="region" aria-label="Mapa interativo"></div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var btnToggle = document.getElementById('btn-toggle-malha-panel');
      var panel = document.getElementById('malha-xlsx-panel');
      var tableContainer = document.getElementById('malha-xlsx-table-container');
      var iconToggle = document.getElementById('icon-toggle-malha');
      var isRetracted = false;
      if (btnToggle && panel && tableContainer && iconToggle) {
        btnToggle.addEventListener('click', function() {
          isRetracted = !isRetracted;
          if (isRetracted) {
            tableContainer.style.display = 'none';
            iconToggle.innerHTML = '&#9654;'; // seta para direita
            btnToggle.setAttribute('aria-label', 'Expandir painel');
          } else {
            tableContainer.style.display = '';
            iconToggle.innerHTML = '&#9660;'; // seta para baixo
            btnToggle.setAttribute('aria-label', 'Retrair painel');
          }
        });
      }
    });
  </script>
</body>
</html>
