<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>CGR 02 - Sistema de Localização</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:," />

  <!-- pré-conexão às CDNs -->
  <link rel="preconnect" href="https://unpkg.com" />
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />

  <!-- Leaflet + HeatLayer -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>
  <script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js" defer></script>

  <!-- JSZip, shp.js, Turf, PapaParse, toGeoJSON -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/shpjs@3.6.2/dist/shp.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@7.2.0/turf.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/togeojson/0.16.0/togeojson.min.js" defer></script>

  <!-- SheetJS (XLSX) para leitura de planilhas Excel no cliente -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js" defer></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js" defer></script>

  <!-- scripts principais -->
  <script src="assets/js/script_colaborativo.js" defer></script>

  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
  </style>
</head>
<body>
  <!-- filtro de rodovia (KMZ) -->
  <div id="rodovia-filter" style="position: fixed; top: 14px; left: 14px; z-index:12000; background: rgba(255,255,255,0.95); padding:8px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.12); font-family: Inter, Roboto, Arial, sans-serif; font-size:13px;">
    <label for="select-rodovia" style="margin-right:8px; font-weight:600;">Rodovia:</label>
    <select id="select-rodovia" style="min-width:220px; padding:6px 8px; border-radius:6px; border:1px solid #e6eefc; background:#fff; color:#0d47a1;">
      <option value="">Todas</option>
    </select>
    <button id="btn-rod-clear" style="margin-left:8px;padding:6px 8px;border-radius:6px;border:none;background:#f1f5f9;">Limpar</button>
  </div>

  <!-- Painel inferior esquerdo: exibe tabela da planilha MALHA CGR02SAC.xlsx -->
  <div id="malha-xlsx-panel" style="position: fixed; bottom: 14px; left: 14px; z-index:12000; background: rgba(255,255,255,0.98); padding:12px; border-radius:8px; box-shadow:0 6px 20px rgba(0,0,0,0.18); font-family: Inter, Roboto, Arial, sans-serif; display:block; min-width:360px; max-width:420px; max-height:60vh; overflow:auto;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
      <strong style="font-size:14px; color:#0d47a1;">Malha (MALHA CGR02SAC.xlsx)</strong>
      <button onclick="document.getElementById('malha-xlsx-panel').style.display='none';" style="background:none; border:none; font-size:18px; cursor:pointer; color:#999; padding:0; line-height:1;">&times;</button>
    </div>
    <div id="malha-xlsx-table-container" style="max-height:50vh; overflow:auto;">
      <div style="color:#666; font-size:13px;">Carregando planilha...</div>
    </div>
  </div>
  
  <!-- Card de Metadados -->
  <div id="rodovia-metadata-card" style="position: fixed; bottom: 14px; right: 14px; z-index:12000; background: rgba(255,255,255,0.99); padding:16px; border-radius:8px; box-shadow:0 6px 20px rgba(0,0,0,0.18); font-family: Inter, Roboto, Arial, sans-serif; display:none; min-width:360px; max-height:80vh; overflow-y:auto;">
    <!-- Cabeçalho -->
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
      <strong id="card-rodovia-nome" style="font-size:15px; color:#0d47a1; font-weight:700;">Rodovia</strong>
      <button id="btn-close-card" onclick="document.getElementById('rodovia-metadata-card').style.display='none';" style="background:none; border:none; font-size:20px; cursor:pointer; color:#999; padding:0; line-height:1;">&times;</button>
    </div>
    
    <!-- Conteúdo com grid de 2 colunas -->
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:14px;">
      <!-- Km Inicial -->
      <div style="background:#f5f7fa; padding:12px; border-radius:6px; border-left:3px solid #0d47a1;">
        <div style="color:#666; font-size:11px; font-weight:600; margin-bottom:4px; text-transform:uppercase;">Km Inicial</div>
        <div id="card-km-inicial" style="color:#0d47a1; font-size:14px; font-weight:600;">-</div>
      </div>
      
      <!-- Km Final -->
      <div style="background:#f5f7fa; padding:12px; border-radius:6px; border-left:3px solid #ff5722;">
        <div style="color:#666; font-size:11px; font-weight:600; margin-bottom:4px; text-transform:uppercase;">Km Final</div>
        <div id="card-km-final" style="color:#ff5722; font-size:14px; font-weight:600;">-</div>
      </div>
    </div>
    
    <!-- Coordenadas Iniciais -->
    <div style="margin-top:14px; background:#f0f7ff; padding:12px; border-radius:6px; border-left:3px solid #0d47a1;">
      <div style="color:#666; font-size:11px; font-weight:600; margin-bottom:6px; text-transform:uppercase;">Lat e Long km Inicial</div>
      <div id="card-lat-long-inicial" style="color:#0d47a1; font-size:12px; font-family:monospace; line-height:1.5; word-break:break-word;">-</div>
    </div>
    
    <!-- Coordenadas Finais -->
    <div style="margin-top:12px; background:#fff5f0; padding:12px; border-radius:6px; border-left:3px solid #ff5722;">
      <div style="color:#666; font-size:11px; font-weight:600; margin-bottom:6px; text-transform:uppercase;">Lat e Long km Final</div>
      <div id="card-lat-long-final" style="color:#ff5722; font-size:12px; font-family:monospace; line-height:1.5; word-break:break-word;">-</div>
    </div>
  </div>
  
  <div id="map"></div>
</body>
</html>
